<!DOCTYPE html>
<html>
<head>
  <style>
    body {
      margin: 0;
      padding: 20px;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #2c2c2c;
      color: #fff;
    }
    
    h1 {
      font-size: 20px;
      margin-bottom: 20px;
    }
    
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .add-btn {
      padding: 8px 16px;
      background: #107c10;
      color: #fff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
    }
    
    .add-btn:hover {
      background: #0e6b0e;
    }
    
    .instances-list {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    
    .instance-card {
      background: #1e1e1e;
      border: 1px solid #555;
      border-radius: 8px;
      padding: 15px;
    }
    
    .instance-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    
    .instance-title {
      font-size: 16px;
      font-weight: bold;
    }
    
    .instance-controls {
      display: flex;
      gap: 8px;
    }
    
    .instance-body {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      font-size: 13px;
    }
    
    .instance-field {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }
    
    .instance-field label {
      color: #aaa;
      font-size: 12px;
    }
    
    .instance-field input[type="text"],
    .instance-field select {
      padding: 6px 10px;
      border: 1px solid #555;
      background: #2c2c2c;
      color: #fff;
      border-radius: 4px;
      font-size: 13px;
    }
    
    .instance-field input[type="checkbox"] {
      width: 18px;
      height: 18px;
    }
    
    button {
      padding: 6px 12px;
      background: #0078d4;
      color: #fff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 13px;
    }
    
    button:hover {
      background: #106ebe;
    }
    
    button.delete-btn {
      background: #c50f1f;
    }
    
    button.delete-btn:hover {
      background: #a00f1f;
    }
    
    button.browse-btn {
      background: #0078d4;
      padding: 6px 10px;
      font-size: 12px;
    }
    
    .preview-img {
      max-width: 80px;
      max-height: 80px;
      border: 1px solid #555;
      border-radius: 4px;
      margin-top: 5px;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>ðŸŽ¬ Manage GIF Instances</h1>
    <div style="display: flex; gap: 10px;">
      <button class="add-btn" id="addBtn">+ Add New Instance</button>
    </div>
  </div>
  
  <div class="instances-list" id="instancesList"></div>
  
  <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #555; color: #aaa; font-size: 12px;">
    ðŸ’¡ Changes are saved automatically. Config file location: <code style="background: #1e1e1e; padding: 2px 6px; border-radius: 3px;">%AppData%/anima-e/config.json</code>
  </div>
  
  <script>
    const { ipcRenderer } = require('electron')
    const path = require('path')
    
    let instances = []
    
    // Load instances
    async function loadInstances() {
      instances = await ipcRenderer.invoke('get-instances')
      renderInstances()
    }
    
    // Render instances list
    function renderInstances() {
      const list = document.getElementById('instancesList')
      list.innerHTML = ''
      
      instances.forEach((instance, index) => {
        const card = document.createElement('div')
        card.className = 'instance-card'
        card.innerHTML = `
          <div class="instance-header">
            <div class="instance-title">Instance #${index + 1}</div>
            <div class="instance-controls">
              <button class="browse-btn" onclick="browseGif('${instance.id}')">Browse GIF</button>
              <button class="delete-btn" onclick="removeInstance('${instance.id}')">Delete</button>
            </div>
          </div>
          <div class="instance-body">
            <div class="instance-field">
              <label>GIF File:</label>
              <input type="text" value="${path.basename(instance.gifPath)}" readonly>
              ${instance.gifPath ? `<img src="${instance.gifPath}" class="preview-img">` : ''}
            </div>
            <div class="instance-field">
              <label>Position:</label>
              <select onchange="updateInstance('${instance.id}', 'position', this.value)">
                <option value="bottom-right" ${instance.position === 'bottom-right' ? 'selected' : ''}>Bottom Right</option>
                <option value="bottom-left" ${instance.position === 'bottom-left' ? 'selected' : ''}>Bottom Left</option>
                <option value="top-right" ${instance.position === 'top-right' ? 'selected' : ''}>Top Right</option>
                <option value="top-left" ${instance.position === 'top-left' ? 'selected' : ''}>Top Left</option>
                <option value="center" ${instance.position === 'center' ? 'selected' : ''}>Center</option>
                <option value="custom" ${instance.position === 'custom' ? 'selected' : ''}>Custom (Drag)</option>
              </select>
            </div>
            <div class="instance-field">
              <label>
                <input type="checkbox" ${instance.clickThrough ? 'checked' : ''} 
                       onchange="updateInstance('${instance.id}', 'clickThrough', this.checked)">
                Click-Through Mode
              </label>
            </div>
            <div class="instance-field">
              <label>
                <input type="checkbox" ${instance.dragMode ? 'checked' : ''} 
                       onchange="updateInstance('${instance.id}', 'dragMode', this.checked)">
                Drag Mode (Always Draggable)
              </label>
            </div>
          </div>
        `
        list.appendChild(card)
      })
    }
    
    // Add new instance
    document.getElementById('addBtn').addEventListener('click', async () => {
      const defaultGifPath = await ipcRenderer.invoke('get-default-gif-path')
      const newInstance = {
        id: 'instance_' + Date.now(),
        gifPath: defaultGifPath,
        clickThrough: false,
        dragMode: false,
        position: 'bottom-right',
        customX: null,
        customY: null
      }
      ipcRenderer.send('add-instance', newInstance)
      instances.push(newInstance)
      renderInstances()
    })
    
    // Browse GIF for instance
    window.browseGif = async (instanceId) => {
      const result = await ipcRenderer.invoke('select-gif-file')
      if (result) {
        updateInstance(instanceId, 'gifPath', result)
      }
    }
    
    // Update instance
    window.updateInstance = (instanceId, field, value) => {
      const instance = instances.find(inst => inst.id === instanceId)
      if (instance) {
        instance[field] = value
        ipcRenderer.send('update-instance', instanceId, { [field]: value })
        renderInstances()
      }
    }
    
    // Remove instance
    window.removeInstance = (instanceId) => {
      if (instances.length === 1) {
        alert('Cannot delete the last instance!')
        return
      }
      if (confirm('Are you sure you want to delete this instance?')) {
        ipcRenderer.send('remove-instance', instanceId)
        instances = instances.filter(inst => inst.id !== instanceId)
        renderInstances()
      }
    }
    
    // Initialize
    loadInstances()
  </script>
</body>
</html>
